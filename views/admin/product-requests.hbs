<section>
  <div class="container">
    <h2 class="main-heading">User Product Requests</h2>
    <div id="orders-container">
       {{#each products}}
      <div class="card">
        <div class="card-header">
          <div class="row header-content">
            <div class="chip">
            {{#ifEquals this.userDetails.Gender 'Male'}}
                <img src="/images/male-icon.jpg" alt="Male Icon">
              {{else}}
                {{#ifEquals this.userDetails.Gender 'Female'}}
                  <img src="/images/female-icon.jpg" alt="Female Icon">
                {{else}}
                  <img src="/images/trans-icon.jpg" alt="Trans Icon">
                {{/ifEquals}}
              {{/ifEquals}}              {{this.Seller_First_Name}} {{this.Seller_Last_Name}}
            </div>
            <div class="date row">
              {{#ifEquals this.Updations 'Updated'}}
              <div class="mr-4 mt-2">
                <span ><b>Updated</b></span>
              
              </div>
                <div>
                  <span style="font-weight:bold"> Date: </span> {{this.UpdatedDate}} <br>
              <span style="font-weight:bold"> Time: </span> {{this.UpdatedTime}}
                </div>
                  {{/ifEquals}}
              </div>
                
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="Date">
              <span style="font-weight:bold"> Date: </span> {{this.Date}} <br>
              <span style="font-weight:bold"> Time: </span> {{this.Time}}
              <p class="card-text mt-2"><span style="font-weight:bold">Status: </span> <span id="status-{{this._id}}">{{this.Status}}</span></p>
            </div>
            <div class="address">
              <span style="font-weight: bold;"> Address:</span><br>{{newlineToBr this.Shop_Address}}
              <br>Ph: {{this.Phone}}
            </div>
          </div>
          <div>
            <table class="table mt-5" id="productsTable">
              <thead>
                <tr>
                  <th scope="col">Item</th>
                  <th scope="col">Price</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="row">
                      <div>
                        <img src="/product-images/{{this._id}}_0.jpg" style="width:100x;height:120px" alt="" class="product_image">
                      </div>
                      <div class="product_details ml-5">
                        {{this.Name}} <br>
                       <span class="text-muted">{{this.Category}}</span> <br>
                        {{newlineToBr this.Description}}
                      </div>
                    </div>
                  </td>
                  <td>Offer Price: ₹{{this.Offer_Price}} <br>({{this.Offer_Percentage}}% off) <br> Net Price: ₹{{this.Actual_Price}} </td> 
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card-footer">
          <div class="footer-content">
            <div id="action-buttons-{{this._id}}" class="approval row">
              {{#ifEquals this.Status 'Pending'}}
                <button onclick="updateUserProdStatus('{{this._id}}', 'Declined')" class="btn btn-primary mr-3" id="decline-btn-{{this._id}}">Declined</button>
                <button onclick="updateUserProdStatus('{{this._id}}', 'Approved')" class="btn btn-primary" id="approve-btn-{{this._id}}">Approved</button>
              {{else ifEquals this.Status 'Declined'}} 
                <button onclick="updateUserProdStatus('{{this._id}}', 'Approved')" class="btn btn-primary" id="approve-btn-{{this._id}}">Approved</button>
              {{/ifEquals}}
            </div>
          </div>
        </div>
      
      {{/each}}
    </div>
  </div>
</section>

<script>
function  updateUserProdStatus(Id, Status) {
  $.ajax({
    url: '/admin/update-user-products-status',
    method: 'POST',
    data: { Id: Id, Status: Status },
    success: function(response) {
      if (response.success) {
        alert(`User Product status updated to ${Status}`);
        document.getElementById('status-' + Id).innerText = Status;

        var approveBtn = document.getElementById('approve-btn-' + Id);
        var declineBtn = document.getElementById('decline-btn-' + Id);

        if (Status === 'Approved') {
          if (approveBtn) approveBtn.style.display = 'none';
          if (declineBtn) declineBtn.style.display = 'none';
        } else if (Status === 'Declined') {
          if (declineBtn) declineBtn.style.display = 'none';
          if (approveBtn) approveBtn.style.display = 'inline-block';
        }
      } else {
        alert('Failed to update user product status');
      }
    },
    error: function(error) {
      console.error('Error:', error);
      alert('An error occurred while updating the user product status');
    }
  });
}
 
</script>

<style>

    .main-heading {
      text-align: center;
      margin-top: 30px;
    }

    .card {
      margin-top: 65px;
    }

    .payment-header {
      font-weight: bold;
    }

    .address {
      margin-left: 5rem;
    }

    .chip {
      display: inline-block;
      padding: 0 25px;
      height: 50px;
      font-size: 16px;
      line-height: 50px;
      border-radius: 25px;
      background-color: #f1f1f1;
    }
  
    .chip img {
      float: left;
      margin: 0 10px 0 -25px;
      height: 50px;
      width: 50px;
      border-radius: 50%;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .footer-content {
      display: flex;
      width: 100%;
      justify-content: space-between;
      align-items: center;
    }

    .approval {
      margin-left: auto;
    }

    .btn-primary {
      margin: 0;
    }

    .date, .payment {
      padding: 0 15px;
    }
    .total{
      margin-left: auto;
    }
    .product_details{
      margin-left: 10px;
    }
  </style>


